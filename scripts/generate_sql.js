const fs = require('fs');

const rawData = `ADRIANA DA COSTA ALENCAR 	 00375272313 	 TEC. ENFERMAGEM 	 631392 
 ADRIANA ALVES DA SILVA 	 	 TEC. ENFERMAGEM 	 801379 
 ADRIANA PEREIRA BARBOSA 	 29083155803 	 TEC. ENFERMAGEM 	 347018 
 ADRIANA SIKORSKI MAIA 	 00465680348 	 TEC. ENFERMAGEM 	 333210 
 ADYNA GOMES DA SILVA SANTOS 	 73986429387 	 TEC. ENFERMAGEM 	 410639 
 ALDEMARES LIMA DE SOUSA 	 84415657320 	 TEC. ENFERMAGEM 	 801381 
 ALDENILDES ALVES RODRIGUES 	 17825993353 	 TEC. ENFERMAGEM 	 93709 
 AMANDA SOUSA FERREIRA 	 	 TEC. ENFERMAGEM 	 590482 
 ANA LEIA DE SOUSA OLIVEIRA 	 50516914391 	 TEC. ENFERMAGEM 	 481473 
 ANA MARIA LOPES DOS SANTOS 	 40188884300 	 TEC. ENFERMAGEM 	 280048 
 ANAYRAM OLIVEIRA FONTENELE 	 	 TEC. ENFERMAGEM 	 1.631.203 
 ANDREA GERONIMO LINS DE LIMA 	 73652954149 	 TEC.ENFERMAGEM 	 1732651TE 
 ANTONIA ADRIANA DELAMARQUE DOS SANTOS 	 03335398343 	 TEC. ENFERMAGEM 	 688777 
 ANTONIA FERREIRA LIMA 	 34492356304 	 TEC. ENFERMAGEM 	 298003 
 ARIEGINA SANTANA SANTOS 	 90914775200 	 TEC. ENFERMAGEM 	 415348 
 ARLENE VIANA DA SILVA 	 27208818304 	 TEC. ENFERMAGEM 	 131585 
 BETHELENE BERNARDES SOUSA ERICEIRA 	 88809820363 	 TEC. ENFERMAGEM 	 155797 
 BIANCA PIMENTEL DA SILVA 	 62910258335 	 TEC. ENFERMAGEM 	 1776376 
 CAMILA OLIVEIRA RIBEIRO DE MENDONÇA 	 61503466337 	 TEC. ENFERMAGEM 	 1583063 
 CHEILA FERREIRA ABREU ARAUJO 	 37009753253 	 TEC. ENFERMAGEM 	 178333 
 CHYRLALYA RAUL ALMEIDA CARVALHO 	 01578032369 	 TEC. ENFERMAGEM 	 567433 
 CICERA ALVES DE MELO 	 24283924334 	 TEC.ENFERMAGEM 	 688661 
 CLACY CRUZ DA ROCHA 	 19429010387 	 TEC. ENFERMAGEM 	 1256025 
 CLEIDE MARIA  SOUSA DE OLIVEIRA 	 89949641349 	 TEC. ENFERMAGEM 	 441332 
 CLEIDE MARIA DE SOUSA MATOS 	 77777786334 	 TEC. ENFERMAGEM 	 423077 
 CRISTIANE DE JESUS BARROS 	 04599267309 	 TEC. ENFERMAGEM 	 1503408 
 CRISTIANE NOGUEIRA  SANTOS 	 00988484374 	 TEC. ENFERMAGEM 	 471543 
 DANIELA MAGALHÃES SILVA 	 	 TEC. ENFERMAGEM 	 1313459 
 DAYANE MELO DE OLIVEIRA 	 60198827300 	 TEC. ENFERMAGEM 	 680164 
 DAYS FERNANDA SILVA DE JESUS BARBOSA 	 02757441329 	 TEC.ENFERMAGEM 	 894578 
 DEBORA MARIA OLIVEIRA DA SILVA 	 01370917376 	 TEC. ENFERMAGEM 	 631399 
 DELZUITE ALVES DE SOUSA 	 25367021387 	 TEC. ENFERMAGEM 	 152873 
 DENYS CRISTIANO ALVES DA SILVA 	 	 TEC. ENFERMAGEM 	 1571397 
 DINAIR FERREIRA MIRANDA 	 40106969315 	 TEC.ENFERMAGEM 	 791223 
 DIONE FEREIRA DE CASTRO 	 75920522372 	 TEC.ENFERMAGEM 	 728263 
 DIVINA IZAURA PEREIRA VIANA 	 00401886395 	 TEC. ENFERMAGEM 	 265263 
 EDEILSON JOSÉ DE ALENCAR DE SOUSA 	 01371688370 	 TEC.ENFERMAGEM 	 558389 
 EDUARDO TEIXEIRA DA SILVA 	 60645793310 	 TEC. ENFERMAGEM 	 1000590 
 ELIENE DOS SANTOS LIMA 	 43556299372 	 TEC. ENFERMAGEM 	 43337 
 ELISANGELA VIANA BRITO 	 77071263353 	 TEC.ENFERMAGEM 	 1070158 
 ELISSON NASCIMENTO DE OLIVEIRA 	 96052120304 	 TEC.ENFERMAGEM 	 433585 
 EUNICE MARIA FAUSTINO 	 01126788317 	 TEC. ENFERMAGEM 	 1545086 
 EURIVANIA CIRQUEIRA DA SILVA 	 80238254372 	 TEC.ENFERMAGEM 	 427229 
 FABIANA MESQUITA VIEIRA 	 95630805649 	 TEC. ENFERMAGEM 	 276327 
 FIAMA SUILA MATOSO AGUIAR 	 0331042520075 	 TEC. ENFERMAGEM 	 1.335.817 
 FLÁVIO SILVA COSTA 	 50503105315 	 TEC. ENFERMAGEM 	 601761 
 FRANCILEA DE SOUSA RODRIGUES 	 86097539304 	 TEC.ENFERMAGEM 	 718287 
 FRANCILENE DA SILVA SANTOS 	 04085414313 	 TEC.ENFERMAGEM 	 1156005 
 FRANCISCA CLERISMAR DA SILVA DINIZ 	 72809558353 	 AUX.  ENFERMAGEM 	 503560 
 FRANCISCA DOS SANTOS  SILVA 	 52327124387 	 TEC. ENFERMAGEM 	 558308 
 FRANCISCA ROSANGELA SANTOS DO NASCIMENTO 	 60946837309 	 TEC. ENFERMAGEM 	 1100815 
 FRANCISCA SOUSA BITENCOURT 	 21773712300 	 TEC.ENFERMAGEM 	 396192 
 GENI DOS SANTOS SILVA 	 00462773310 	 TEC. ENFERMAGEM 	 661685 
 GEOVANE SILVA DOS SANTOS 	 00359673317 	 TEC. ENFERMAGEM 	 726170 
 GILBERTO SOARES DA SILVA 	 93026838349 	 TEC. ENFERMAGEM 	 317059 
 GILDEANE MISSIAS CARDOSO 	 00853033407 	 TEC. ENFERMAGEM 	 493447 
 GRACIENE SILVA DE ARAUJO 	 03502194351 	 TEC.ENFERMAGEM 	 769745 
 GRACIVANIA MARIA SOARES DA SILVA 	 75059096300 	 AUX.  ENFERMAGEM 	 337953 
 HIDARIO LIMA DA SILVA 	 05791826303 	 TEC.ENFERMAGEM 	 2015770-TE 
 IACI SOUSA DA SILVA 	 37009745234 	 TEC. ENFERMAGEM 	 433781 
 IRANDIR ALVES DOS SANTOS 	 00818692316 	 TEC.ENFERMAGEM 	 361564 
 IRENILDE VIEIRA ROCHA CARDOSO 	 34435948320 	 TEC. ENFERMAGEM 	 506597 
 ISABELA FREITAS LEDA 	 60586075313 	 TEC. ENFERMAGEM 	 150949 
 ITA ALANA NASCIMENTO TEIXEIRA 	 05138571338 	 TEC. ENFERMAGEM 	 1256032 
 ITEVALDO DOS REIS TORRES 	 94094322353 	 TEC.ENFERMAGEM 	 2032948 
 JAHN DE SOUSA DOURADO 	 90434838249 	 TEC. ENFERMAGEM 	 1553003 
 JESSICA MARIA ALMEIDA DA SILVA 	 06123362399 	 TEC.ENFERMAGEM 	 1629343 
 JOANA DARK DE OLIVEIRA MENDES 	 344370613 	 TEC. ENFERMAGEM 	 379494 
 JOELMA DUTRA DA SILVA 	 00130279307 	 TEC.ENFERMAGEM 	 724892 
 JOELMA PEREIRA DOS SANTOS 	 02618805356 	 TEC.ENFERMAGEM 	 917288 
 JOSE CARLOS PINTO VIANA 	 05509617390 	 TEC. ENFERMAGEM 	 1895396 
 JOSE FLAVIO BORGES GOMES 	 74314882387 	 TEC.ENFERMAGEM 	 131580 
 JOSEANA FERNANDES DOS SANTOS 	 71834320330 	 TEC. ENFERMAGEM 	 476214 
 JOSEANE  ELIAS DOS SANTOS 	 02068634201 	 TEC.ENFERMAGEM 	 1780995-TE 
 JOSEFA ALMEIDA SILVA OLIVEIRA 	 	 TEC. ENFERMAGEM 	 812557 
 JOSÉLIA DE FÁTIMA ATAIDES 	 33363870353 	 TEC. ENFERMAGEM 	 694268 
 JOSILENE SOARES DE SOUSA 	 84807369334 	 TEC.ENFERMAGEM 	 265262 
 JOVENILIA BARBOSA LIMA 	 86421344372 	 TEC. ENFERMAGEM 	 316769 
 JOYLANIA DIAS BARROS 	 84196289304 	 TEC. ENFERMAGEM 	 339084 
 JULIANA BONJARDIM FIGUEREDO 	 03551063370 	 TEC. ENFERMAGEM 	 2031985 
 JULIMAR MIRANDA DA SILVA 	 05424854354 	 TEC. ENFERMAGEM 	 1147906 
 KARLA ALVES SANTANA 	 02324367386 	 TEC. ENFERMAGEM 	 583377 
 LEDAIANE GONÇALVES FIGUEREDO 	 01309588325 	 TEC. ENFERMAGEM 	 333172 
 LELIA MARIA DA SILVA ROCHA 	 	 TEC. ENFERMAGEM 	 467657 
 LENICLÉA MACIEL MOTA 	 40277666368 	 TEC. ENFERMAGEM 	 789516 
 LEONARDO MOURÃO DOS REIS 	 	 TEC. ENFERMAGEM 	 1493785 
 LERILENE RIBEIRO SILVA 	 57644950320 	 AUX. ENFERMAGEM 	 446798 
 LETÍCIA ABREU DE JESUS RODRIGUES 	 	 TEC. ENFERMAGEM 	 1552763 
 LIDIONEZA ALVES PEREIRA 	 48114500310 	 TEC. ENFERMAGEM 	 333099 
 LINDALVA RABELO SOUSA 	 	 TEC. ENFERMAGEM 	 1929742 
 LIVIA RAMOS DE SOUSA 	 	 TEC. ENFERMAGEM 	 2309249 
 LUCELIA  FERREIRA DA CRUZ 	 75181231349 	 TEC.ENFERMAGEM 	 805412 
 LUCIANA VIEIRA DA SILVA 	 98947176320 	 TEC.ENFERMAGEM 	 720222 
 LUCIMAR SANTANA DO VALE 	 33359717368 	 TEC. ENFERMAGEM 	 450176 
 LUIZA MARIA OLIVEIRA SILVA 	 24560944334 	 TEC. ENFERMAGEM 	 118963 
 LUZINEIDE SILVA FIGUEREDO 	 624130663-49 	 TEC. ENFERMAGEM 	 548201 
 MARIA APARECIDA BATISTA MARTINS 	 	 TEC. ENFERMAGEM 	 2221456 
 MARIA CHIRLENE MESQUITA COSTA DA CONCEIÇAO 	 9906522`;

function formatCPF(cpf) {
  if (!cpf || cpf.length < 11) return null;
  // remove non digits
  const clean = cpf.replace(/\D/g, '');
  if (clean.length !== 11) return null;
  return clean.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
}

function generateDummyCPF(index) {
  // Generate valid-looking but dummy CPF: 000.000.XXX-XX
  const suffix = index.toString().padStart(3, '0');
  return `000.000.${suffix}-00`;
}

const lines = rawData.split('\n').filter(l => l.trim());
const values = [];

lines.forEach((line, index) => {
  // Try to parse: Name | CPF (optional) | Role | Coren
  // Strategy: 
  // 1. Role is usually "TEC. ENFERMAGEM" or "AUX. ENFERMAGEM" or "TEC.ENFERMAGEM"
  // Split by that to isolate Name+CPF from Coren
  
  let role = 'TECNICO';
  let roleRaw = '';
  
  if (line.includes('AUX.')) {
    role = 'AUXILIAR';
    roleRaw = 'AUX. ENFERMAGEM'; // Approx
  } else {
    roleRaw = 'TEC. ENFERMAGEM'; // Approx
  }
  
  // Regex to find the role part
  const roleMatch = line.match(/(TEC\.|AUX\.)\s*ENFERMAGEM/i);
  if (!roleMatch) {
      // Maybe truncated line
      console.log(`-- Skipped (no role found): ${line}`);
      return;
  }
  
  const roleIndex = roleMatch.index;
  const preRole = line.substring(0, roleIndex).trim();
  const postRole = line.substring(roleIndex + roleMatch[0].length).trim();
  
  const coren = postRole; // The part after role is Coren
  
  // The part before role is Name + CPF
  // Check if it ends with digits (CPF)
  let name = preRole;
  let cpf = null;
  
  const cpfMatch = preRole.match(/(\d{9,11}|\d{3}\.\d{3}\.\d{3}-\d{2})$/);
  if (cpfMatch) {
      cpf = cpfMatch[0];
      name = preRole.substring(0, cpfMatch.index).trim();
  }
  
  let formattedCpf = formatCPF(cpf);
  if (!formattedCpf) {
      formattedCpf = generateDummyCPF(index + 1);
  }
  
  // Escape single quotes for SQL
  const safeName = name.replace(/'/g, "''");
  const safeCoren = coren.replace(/'/g, "''");
  
  values.push(`('${safeName}', '${safeCoren}', '${role}', '${formattedCpf}')`);
});

const sql = `
-- Bulk import nurses
INSERT INTO nurses (name, coren, role, cpf) VALUES
${values.join(',\n')}
ON CONFLICT (cpf) DO NOTHING;
`;

fs.writeFileSync('c:\\Users\\ferna\\Documents\\trae_projects\\ENF-HMA\\supabase\\bulk_import_nurses.sql', sql);
console.log('SQL generated successfully.');
